---
// Extract unique categories from all blog posts
const posts = await Astro.glob('../pages/blog/*.md');
const allCategories = posts.flatMap(post => post.frontmatter.categories || []);
const uniqueCategories = [...new Set(allCategories)].sort();

// Get current category prop if provided
const { currentCategory } = Astro.props;
---

<aside class="w-full">
  <div class="mb-8">
    <h2 class="text-2xl font-bold mb-4 text-slate-900">About</h2>
    <div class="card bg-white shadow-xl">
      <div class="card-body">
        <p class="text-slate-600 leading-relaxed mb-3">「RunFun」と書いて「るんふん」</p>
        <p class="text-slate-700 leading-relaxed mb-3 font-semibold">WEB ENGINEER 小波津 駿</p>
        <p class="text-slate-600 leading-relaxed mb-0">沖縄県にてフリーのWEBエンジニアとして活動中。</p>
      </div>
    </div>
  </div>

  <!-- Categories Section -->
  <div class="mb-8">
    <h2 class="text-2xl font-bold mb-4 text-slate-900">Category</h2>
    <div class="card bg-white shadow-xl">
      <div class="card-body p-0">
        {uniqueCategories.map((category, index) => (
          <a href={`/category/${category.toLowerCase().replace(/\s+/g, '-')}`}
             class={`flex items-center justify-between px-6 py-4 no-underline transition-colors ${
               index !== uniqueCategories.length - 1 ? 'border-b border-slate-200' : ''
             } ${
               currentCategory === category
                 ? 'bg-primary text-white'
                 : 'hover:bg-slate-100'
             }`}>
            <span class={`text-base ${
              currentCategory === category ? 'text-white' : 'text-slate-700'
            }`}>{category}</span>
            <span class={`badge ${
              currentCategory === category
                ? 'badge-primary-content'
                : 'badge-ghost'
            }`}>
              {posts.filter(post => post.frontmatter.categories?.includes(category)).length}
            </span>
          </a>
        ))}
      </div>
    </div>
  </div>
</aside>
