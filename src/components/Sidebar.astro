---
// Extract unique categories from all blog posts
const posts = await Astro.glob('../pages/blog/*.md');
const allCategories = posts.flatMap(post => post.frontmatter.categories || []);
const uniqueCategories = [...new Set(allCategories)].sort();
---

<aside class="sidebar">
  <div class="sidebar-section">
    <h2 class="sidebar-heading">About</h2>
    <div class="about-box">
      <p>「RunFun」と書いて「るんふぁん」</p>
      <p>WEB ENGINEER 小波津 駿</p>
      <p>沖縄県にてフリーのWEBエンジニアとして活動中。技術ブログやランニングに関するお役立ち情報を更新しています。</p>
    </div>
  </div>

  <!-- Categories Section -->
  <div class="sidebar-section">
    <h2 class="sidebar-heading">Category</h2>
    <div class="categories-box">
      {uniqueCategories.map((category) => (
        <a href={`/category/${category.toLowerCase().replace(/\s+/g, '-')}`} class="category-link">
          <span class="category-name">{category}</span>
          <span class="category-count">
            {posts.filter(post => post.frontmatter.categories?.includes(category)).length}
          </span>
        </a>
      ))}
    </div>
  </div>
</aside>

<style>
  .sidebar {
    width: 100%;
  }

  .sidebar-section {
    margin-bottom: 2rem;
  }

  .sidebar-heading {
    font-size: 1.5rem;
    font-weight: bold;
    color: #1e293b; /* text-slate-800 */
    margin-bottom: 1rem;
  }

  .about-box {
    background-color: white;
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
  }

  .about-box p {
    color: #475569; /* text-slate-600 */
    line-height: 1.5;
    margin-bottom: 0.75rem;
  }

  .about-box p:last-child {
    margin-bottom: 0;
  }

  .categories-box {
    background-color: white;
    border-radius: 0.75rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
    overflow: hidden;
  }

  .category-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f1f5f9; /* border-slate-100 */
    color: inherit;
    text-decoration: none;
    transition: background-color 0.15s;
  }

  .category-link:last-child {
    border-bottom: none;
  }

  .category-link:hover {
    background-color: #f1f5f9; /* bg-slate-100 */
  }

  .category-name {
    color: #334155; /* text-slate-700 */
    font-size: 1rem;
  }

  .category-count {
    font-size: 0.75rem;
    font-weight: 600;
    color: #64748b; /* text-slate-500 */
    background-color: #e2e8f0; /* bg-slate-200 */
    padding: 0.25rem 0.5rem;
    border-radius: 9999px; /* rounded-full */
  }

  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .sidebar {
      position: static;
      margin-bottom: 2rem;
    }
  }
</style>